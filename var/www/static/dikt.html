<!doctype html>
<html>
  <head>
        <meta charset="utf-8">
        <title>Dikt</title>
        <script type="text/javascript">
          function poem(id, kommando, title) {
              var xhr = new XMLHttpRequest();
              xhr.open("POST", "dikt.cgi?brukernavn=djkdsf&passord=jkdskdkjn", false);
              xhr.onreadystatechange = function() {
                if (xhr.readyState === 4)
                {
                  //alert(xhr.responseText);
                  document.getElementById(id).innerHTML = this.responseText;
                }
              };
              xhr.send(kommando + "," + title);
          }
          function getSelectedText(elementId) {
            var elt = document.getElementById(elementId);

            if (elt.selectedIndex == -1)
              return null;

            return elt.options[elt.selectedIndex].value;
          }
          function editPoem(kommando, title) {
            if(document.getElementById('innhold') == "") {
              alert('et dikt har ikke blitt valgt');
              return null;
            }
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "dikt.cgi?brukernavn=djkdsf&passord=jkdskdkjn", false);
            var dikt = document.getElementById('innhold').value;

            xhr.send(kommando + "," + title + "," + dikt);
                          
          } 

          function deletePoem(kommando, title) {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "dikt.cgi?brukernavn=djkdsf&passord=jkdskdkjn", false);
            if(kommando === "<deletepoem>") {
              xhr.send(kommando + "," + title);
            }
            else if(kommando === "<deletepoems>") {
              xhr.send(kommando);
            }
          }
          //window.onload = updateList;
        </script>
  </head>
  <body>
    <form action=>
        <!-- listen skal kunne ta imot navn fra db-->
        <select id="list" size=5>
        </select>
        <br>
        <input type="button" value="hent alle dikt" onclick="poem('list', '<updateList>', all)">
        <input type="button" value="vis dikt" onclick="poem('innhold', '<getPoem>', getSelectedText('list'))">
        <input type="button" value="rediger dikt" onclick="editPoem('<editPoem>', getSelectedText('list'), )">
        <input type="button" value="slett dikt" onclick="deletepoem('<deletePoem>', getSelectedText('list'))">
        <input type="button" value="slett alle dikt" onclick="deletepoem('<deletePoems>')">
        <button type="button" onclick="document.getElementById('nyttdikt').style.display='block'">opprett nytt dikt</button>
        <br>
        <div id="nyttdikt" style="display:none">
        Diktnavn: <input id=navn type="text" name="diktnavn"><br>
        <input type="submit" value="lagre" align="right" onclick="('<savePoem>', document.getElementById('navn').value)">
        <input type="button" value="avbryt" onclick="document.getElementById('nyttdikt').style.display='none';document.getElementById('navn').value=''; document.getElementById('innhold').value=''">
        </div>
        <textarea name="dikt" id="innhold" rows="12" cols="60" ></textarea><br>
        <script>
          document.getElementById("list").innerHTML = xhttp.responseText;
        </script>
    </form>
    
  </body>

</html>